{% extends "adminBase.html" %}
{% load static %}
{% block adminContents %}
<script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
<style>
    /* Container to center the chat window */
    .chat-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        height: calc(100vh - 100px); /* Adjust based on the height of your header */
        margin-left: 250px; /* Adjust based on sidebar width */
    }
    #chat_window {
        background-color: #ffffff;
        border-radius: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 100%;
        height: 600px; /* Fixed height for the chat window */
        display: flex;
        flex-direction: column;
    }
    #chat_container {
        scrollbar-width: none;
        -ms-overflow-style: none;
        height: 450px; /* Set a fixed height for the chat container */
        overflow-y: auto; /* Enable vertical scrolling */
    }
    #chat_container::-webkit-scrollbar {
        display: none;
    }
    .message-bubble {
        max-width: 80%;
        word-wrap: break-word;
        padding: 12px 16px;
        margin-bottom: 8px;
        border-radius: 18px;
    }
    .message-bubble.sent {
        background-color: #5c6bc0;
        color: white;
        border-bottom-right-radius: 4px;
        align-self: flex-end;
    }
    .message-bubble.received {
        background-color: #e8eaf6;
        color: #333;
        border-bottom-left-radius: 4px;
        align-self: flex-start;
    }
    .message-input {
        border: none;
        outline: none;
        padding: 12px 20px;
        border-radius: 24px;
        background-color: #f0f2f5;
        width: 100%;
    }
    .send-button {
        background-color: #5c6bc0;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        flex-shrink: 0;
    }
    li {
        list-style: none;
    }
</style>

<div class="chat-wrapper">
    <div id="chat_window" class="w-full flex flex-col h-[600px] my-3">
        <div id="chat_container" class="flex-grow overflow-y-auto p-4 space-y-4">
            <ul id="chat_messages" class="space-y-4">
                {% for message in messages reversed %}
                {% include "adminChatMessage.html" %}
                {% endfor %}
            </ul>
        </div>
        <div class="bg-white p-4 rounded-b-[30px] border-t border-gray-200">
            <form id="chat_message_form" method="POST" class="flex items-center"
                  hx-ext="ws"
                  ws-connect="/ws/chatroom/{{ chatroomName }}"
                  ws-send
                  _="on htmx:wsAfterSend reset() me">
                {% csrf_token %}
                {{ form.as_p }}
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block adminchatjs %}
<script>
    function scrollToBottom() {
        const container = document.getElementById('chat_container');
        container.scrollTop = container.scrollHeight;
    }
    scrollToBottom();
</script>
{% endblock %}