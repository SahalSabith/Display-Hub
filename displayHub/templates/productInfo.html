{% extends "base.html" %}
{% block baseContents %}
{% load static %}
<link rel="stylesheet" href="{% static "css/productInfo.css" %}">
<div class="site-section">
    <div class="container">
        <div class="row">
            <!-- Thumbnails and Main Image -->
            <div class="col-md-6 d-flex">
                <div class="thumbnails col-3 d-flex flex-column">
                    {% if product.image1 %}
                        <img src="{{ product.image1.url }}" class="thumbnail-img mb-2" onclick="updateMainImage('{{ product.image1.url }}')">
                    {% endif %}
                    {% if product.image2 %}
                        <img src="{{ product.image2.url }}" class="thumbnail-img mb-2" onclick="updateMainImage('{{ product.image2.url }}')">
                    {% endif %}
                    {% if product.image3 %}
                        <img src="{{ product.image3.url }}" class="thumbnail-img mb-2" onclick="updateMainImage('{{ product.image3.url }}')">
                    {% endif %}
                    {% if product.image4 %}
                        <img src="{{ product.image4.url }}" class="thumbnail-img mb-2" onclick="updateMainImage('{{ product.image4.url }}')">
                    {% endif %}
                </div>
                <div class="main-image col-9">
                    <img id="mainImage" src="{{ product.image1.url }}" alt="Product Image" class="img-fluid zoomable" onmousemove="zoomImage(event)" onmouseleave="resetZoom()">
                </div>
            </div>

            <!-- Product Information Section -->
            <div class="col-md-6 product-info-section">
                <h2 class="productName">{{ product.name }}</h2>
                {% if product.varient.first.stock <= 0 %}
                <h6><strong id="price" class="text-danger h4">Out Of Stock</strong></p>
                {% else %}
                <h6><strong id="price" class="text-primary h4">₹ {{ product.varient.first.price }}</strong></p>
                {% endif %}
                <h6 id="size">Size: {{ product.varient.first.size.size }} inch</h6>
                <h6>Resolution: {{ product.resolution }}p</h6>
                <h6 id="refreshRate">Refresh Rate: {{ product.varient.first.refreshRate.refreshRate }}Hz</h6>
                {% if product.varient.first.stock == 0 or product.varient.first.stock < 0 %}
                <h6 class="text-danger" id="stock">Out Of Stock We Will update It Soon</h6>
                {% else %}
                <h6 id="stock">Only {{ product.varient.first.stock }} Left</h6>
                {% endif %}

                <!-- Variant Selection -->
                <div class="filter-options horizontal-options">
                    <legend>Monitor Size</legend>
                    <div id="sizeOptions" class="option-item">
                        {% for size in varientSize %}
                        <div class="option-item">
                            <input type="radio" id="size-{{ size.size_id }}" name="monitorSize" value="{{size.size_id}}" />
                            <label for="size-{{ size.size_id }}">{{size.size__size}} inches</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="filter-options horizontal-options">
                    <legend>Refresh Rate</legend>
                    <div id="refreshRateOptions" class="option-item">
                        {% for refreshrate in varientRefreshRates %}
                        <div class="option-item">
                            <input type="radio" id="refresh-{{ refreshrate.refreshRate_id }}" name="refreshRate" value="{{ refreshrate.refreshRate_id }}" />
                            <label for="refresh-{{ refreshrate.refreshRate_id }}">{{ refreshrate.refreshRate__refreshRate }} Hz</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>                          
              
                <!-- Customer Reviews -->
                <div class="star-rating d-flex">
                    <i class="bi bi-star" data-value="1"></i>
                    <i class="bi bi-star" data-value="2"></i>
                    <i class="bi bi-star" data-value="3"></i>
                    <i class="bi bi-star" data-value="4"></i>
                    <i class="bi bi-star" data-value="5"></i>
                </div>
              
                <!-- Buttons -->
                {% if product.varient.first.stock <= 0 %}
                {% else %}
                <div class="d-flex mt-4">
                    <form action="{% url 'addToCart' product.id %}" method="post" id="addToCartForm">
                        {% csrf_token %}
                        <!-- Quantity input -->
                        <div class="mb-5">
                            <div class="input-group mb-3" style="max-width: 120px;">
                                <div class="input-group-prepend">
                                    <button class="btn btn-outline-primary js-btn-minus" type="button">&minus;</button>
                                </div>
                                <input name="quantity" type="text" class="form-control text-center" value="1" placeholder="" aria-label="Example text with button addon" aria-describedby="button-addon1">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-primary js-btn-plus" type="button">&plus;</button>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store the selected variant ID -->
                        <input type="hidden" name="variant_id" id="variantId" value="{{ product.varient.first.id }}">

                        <button type="submit" class="buy-now btn btn-primary me-2" style="width: 150px;">Add To Cart</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Offers and Coupons Section -->
        <section id="offers-coupons" class="my-5">
            <div class="container">
                <h2 class="mb-4">Available Offers & Coupons</h2>
                <div class="offers-list">
                    <div class="offer mb-2 p-2 border rounded">
                        <h5 class="mb-1">Buy One Get One 50% Off</h5>
                        <p class="mb-1">Purchase one monitor and get a second monitor at 50% off. Limited time offer!</p>
                        <p class="text-muted mb-0">Expires: September 30, 2024</p>
                    </div>
                    <div class="offer mb-2 p-2 border rounded">
                        <h5 class="mb-1">Save $100 on Your Purchase</h5>
                        <p class="mb-1">Get an instant $100 discount on any monitor. Use code: MONITOR100 at checkout.</p>
                        <p class="text-muted mb-0">Expires: October 15, 2024</p>
                    </div>
                    <div class="coupon mb-2 p-2 border rounded">
                        <h5 class="mb-1">Additional 10% Off for Members</h5>
                        <p class="mb-1">Exclusive offer for members. Get an additional 10% off on your purchase.</p>
                        <p class="text-muted mb-0">Expires: October 31, 2024</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customer Reviews Section -->
        <section id="customer-reviews" class="my-5">
            <div class="container">
                <h2 class="mb-4">Customer Reviews</h2>
                <div class="review mb-3 p-3 border rounded">
                    <h5 class="mb-2">John Doe</h5>
                    <p class="mb-1">"Great product! The quality is top-notch and the delivery was fast. Highly recommend."</p>
                    <p class="text-muted mb-0">Rating: ★★★★☆</p>
                </div>
                <div class="review mb-3 p-3 border rounded">
                    <h5 class="mb-2">Jane Smith</h5>
                    <p class="mb-1">"Good value for money. The monitor performs well, but the packaging could be improved."</p>
                    <p class="text-muted mb-0">Rating: ★★★☆☆</p>
                </div>
                <div class="review mb-3 p-3 border rounded">
                    <h5 class="mb-2">Alice Johnson</h5>
                    <p class="mb-1">"Excellent service and a fantastic product. I am very satisfied with my purchase."</p>
                    <p class="text-muted mb-0">Rating: ★★★★★</p>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
    function updateMainImage(src) {
        const mainImage = document.getElementById('mainImage');
        mainImage.src = src;
    }

    function zoomImage(event) {
        const img = event.target;
        img.classList.add('zoomed');
    }

    function resetZoom() {
        const img = document.getElementById('mainImage');
        img.classList.remove('zoomed');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const sizeOptions = document.getElementById('sizeOptions');
        const refreshRateOptions = document.getElementById('refreshRateOptions');
        const priceElement = document.getElementById('price');
        const sizeElement = document.getElementById('size');
        const refreshRateElement = document.getElementById('refreshRate');
        const stockElement = document.getElementById('stock');
        
        function sendSelection() {
            const size = document.querySelector('input[name="monitorSize"]:checked')?.value;
            const refreshRate = document.querySelector('input[name="refreshRate"]:checked')?.value;
            const pId = "{{ product.id }}"; 
            
            fetch(`/product/${pId}/`, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({ size: size, refreshRate: refreshRate })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    // Update price, size, refresh rate, stock based on the selected variant
                    if (data.price) {
                        priceElement.textContent = `₹ ${data.price}`;
                        sizeElement.textContent = `Size: ${data.size} inch`;
                        refreshRateElement.textContent = `Refresh Rate: ${data.refreshRate} Hz`;
                        if (data.stock <= 0) {
                            stockElement.textContent = `Out Of Stock We will update it soon`;
                            priceElement.textContent = `Out Of Stock`;
                            priceElement.style.color = 'red';
                            stockElement.style.color = 'red';
                        } else if (data.stock <= 5) {
                            stockElement.textContent = `Only ${data.stock} Left`;
                            stockElement.style.color = 'red';
                        } else {
                            stockElement.textContent = `Stock Left: ${data.stock}`;
                            stockElement.style.color = 'black';
                        }
                    }
    
                    // Update refresh rate options if available
                    if (data.refreshRates) {
                        refreshRateOptions.innerHTML = '';  // Clear existing options
                        data.refreshRates.forEach(rate => {
                            const input = document.createElement('input');
                            input.type = 'radio';
                            input.id = `refresh-${rate.refreshRate_id}`;
                            input.name = 'refreshRate';
                            input.value = rate.refreshRate_id;
    
                            const label = document.createElement('label');
                            label.htmlFor = input.id;
                            label.textContent = `${rate.refreshRate__refreshRate} Hz`;
    
                            refreshRateOptions.appendChild(input);
                            refreshRateOptions.appendChild(label);
                        });
                    }
    
                    // Update size options if available
                    if (data.sizeOptions) {
                        sizeOptions.innerHTML = '';  // Clear existing options
                        data.sizeOptions.forEach(size => {
                            const input = document.createElement('input');
                            input.type = 'radio';
                            input.id = `size-${size.size_id}`;
                            input.name = 'monitorSize';
                            input.value = size.size_id;
    
                            const label = document.createElement('label');
                            label.htmlFor = input.id;
                            label.textContent = `${size.size__size} inches`;
    
                            sizeOptions.appendChild(input);
                            sizeOptions.appendChild(label);
                        });
                    }
    
                    // Update session data in the client side (for demonstration, you would actually do this on the server side)
                    document.querySelector('input[name="monitorSize"]').value = size;
                    document.querySelector('input[name="refreshRate"]').value = refreshRate;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    
        // Add event listeners to trigger sendSelection on size or refresh rate selection
        sizeOptions.addEventListener('change', sendSelection);
        refreshRateOptions.addEventListener('change', sendSelection);
    });    
</script>

{% endblock %}