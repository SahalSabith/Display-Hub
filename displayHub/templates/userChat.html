{% extends "base.html" %}
{% block baseContents %}
<script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
<style>
    #chat_window {
        background-color: #ffffff;
        border-radius: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        margin: 0 auto;
    }
    #chat_container {
        scrollbar-width: none;
        -ms-overflow-style: none;
        height: 450px; /* Set a fixed height for the chat container */
        overflow-y: auto; /* Enable vertical scrolling */
    }
    #chat_container::-webkit-scrollbar {
        display: none;
    }
    .message-bubble {
        max-width: 80%;
        word-wrap: break-word;
        padding: 12px 16px;
        margin-bottom: 8px;
        border-radius: 18px;
    }
    .message-bubble.sent {
        background-color: #5c6bc0;
        color: white;
        border-bottom-right-radius: 4px;
        align-self: flex-end;
    }
    .message-bubble.received {
        background-color: #e8eaf6;
        color: #333;
        border-bottom-left-radius: 4px;
        align-self: flex-start;
    }
    .message-input {
        border: none;
        outline: none;
        padding: 12px 20px;
        border-radius: 24px;
        background-color: #f0f2f5;
        width: 100%;
    }
    .send-button {
        background-color: #5c6bc0;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        flex-shrink: 0;
    }
    li {
        list-style: none;
    }
</style>

    <div id="chat_window" class="w-full flex flex-col h-[600px] my-3">
        <div id="chat_container" class="flex-grow overflow-y-auto p-4 space-y-4">
            <ul id="chat_messages" class="space-y-4">
                {% for message in messages reversed%}
                {% include "userChatMessages.html" %} 
                {% endfor %}
            </ul>
        </div>
        <div class="bg-white p-4 rounded-b-[30px] border-t border-gray-200">
            <form id="chat_message_form" method="POST" class="flex items-center"
            hx-ext="ws"
            ws-connect="/ws/chatroom/{{chatroomName}}"
            ws-send
            _="on htmx:wsAfterSend reset() me">
          {% csrf_token %}
          {{ form.body }}
      </form>      
        </div>
    </div>
{% endblock %}

{% block chatjs %}
<script>
    function scrollToBottom(){
        const container = document.getElementById('chat_container');
        container.scrollTop = container.scrollHeight
    }
    scrollToBottom()
</script>
{% endblock  %}
